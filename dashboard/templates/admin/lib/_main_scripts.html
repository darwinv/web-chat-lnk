{% load static i18n api_tools %}
<!-- Este archivo es llamado por toda la App para cumplir funciones  -->
<!-- personalizadas para 2 o mas vistas -->
<script>
	
	// get globar api var traidas desde api_tools
	{% autoescape off %}
		var urlBase   		= '{% get_api_url %}';	
		var headers  		= {% get_api_header %}; //Retorna un Objeto
	{% endautoescape %}	

    $(document).on('change', '#id_department', function() {
    	url 	= urlBase+'provinces'
    	id 		= $(this).val();
    	element = $('#id_province');
    	elementB= $('#id_district');

    	clearOptions(element)
    	clearOptions(elementB)
    	data = {'department': id}
    	msg  = sendAjaxGeo(url,data,element);
	});

	$(document).on('change', '#id_province', function() {
    	url 	= urlBase+'districts'
    	id 		= $(this).val();
    	element = $('#id_district');

    	clearOptions(element)
    	data = {'province': id}
    	msg  = sendAjaxGeo(url,data,element);
	});
    
	function sendAjaxGeo(url,data,element,type="GET"){
		var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
		$.ajax({
		  type: type,
		  beforeSend: function(request, settings) {
		  	if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
	            request.setRequestHeader("X-CSRFToken", csrftoken);
	        }
	        // Recorremos cabeceras
		    for (var key in headers){
			    if (headers.hasOwnProperty(key)) {
			         request.setRequestHeader(key, headers[key]);
			    }
			}
		  },
		  url: url,
		  data:data,
		  dataType: "json",
		  success: function(msg) {
			generateOptions(element,msg.list);
		  }
		});
	}
	function generateOptions(element,data) {
			element.append('<option>{% trans "select"|title %}</option>')
			$.each(data, function(){
				element.append('<option value="'+ this.name +'">'+ this.name +'</option>')			
			});
	}

	function clearOptions(element){
		element.find('option').remove();
	}


	// Funciones genericas para borrar desde listado
	//
	// Funcion para borrar 
	$(document).on('click', '.deleteSpecialist', function() {
    	id 		= $(this).data('id');
    	url 	= '{% url "dashboard:actor-specialists-delete"  %}'
    	data 	= {'specialist_id': id}

    	sendAjaxDelete(url,data,$(this),'POST');
	});
	function sendAjaxDelete(url,data,element,type='POST'){
		var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
		$.ajax({
		  type: type,
		  beforeSend: function(request, settings) {
		  	if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
	            request.setRequestHeader("X-CSRFToken", csrftoken);
	        }
	        // Recorre cabeceras por clave y valor
		    for (var key in headers){
			    if (headers.hasOwnProperty(key)) {
			         request.setRequestHeader(key, headers[key]);
			    }
			}
		  },
		  url: url,
		  data:data,
		  dataType: "json",
		  success: function(msg) {
			element.closest("form").submit(); // Podria ser reloadPage pero conservar filtros
		  }
		});
	}
	function csrfSafeMethod(method) {
	    // these HTTP methods do not require CSRF protection
	    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
	}
	// using jQuery
	function getCookie(name) {
	    var cookieValue = null;
	    if (document.cookie && document.cookie !== '') {
	        var cookies = document.cookie.split(';');
	        for (var i = 0; i < cookies.length; i++) {
	            var cookie = jQuery.trim(cookies[i]);
	            // Does this cookie string begin with the name we want?
	            if (cookie.substring(0, name.length + 1) === (name + '=')) {
	                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
	                break;
	            }
	        }
	    }
	    return cookieValue;
	}
	
	
	
</script>