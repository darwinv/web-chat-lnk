{% load static i18n %}

{% block scripts %}
<script src="{% static "jquery/dist/jquery.min.js" %}"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
    $.widget.bridge('uibutton', $.ui.button);
</script>
<script src="{% static "bootstrap/dist/js/bootstrap.min.js" %} "></script>
<script src="{% static "admin-lte/dist/js/app.min.js" %}"></script>
<script>
	var urlBase   	= 'https://04c2b9c2-5111-46b4-bf48-21ead5cea35d.mock.pstmn.io/'
	var x_api_key   = '90bd028513c2440f9c262c5c09c668e5'
    $(document).on('change', '#id_department', function() {
    	url 	= urlBase+'provinces'
    	id 		= $(this).val();
    	element = $('#id_province');
    	elementB= $('#id_district');

    	clearOptions(element)
    	clearOptions(elementB)
    	data = {'department': id}
    	msg  = sendAjaxGeo(url,data,element);
	});

	$(document).on('change', '#id_province', function() {
    	url 	= urlBase+'districts'
    	id 		= $(this).val();
    	element = $('#id_district');

    	clearOptions(element)
    	data = {'province': id}
    	msg  = sendAjaxGeo(url,data,element);
	});

    
	function sendAjaxGeo(url,data,element,type="GET"){
		var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
		$.ajax({
		  type: type,
		  beforeSend: function(request, settings) {
		  	if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
	            request.setRequestHeader("X-CSRFToken", csrftoken);
	        }
		    request.setRequestHeader('x-api-key', x_api_key);
		  },
		  url: url,
		  data:data,
		  dataType: "json",
		  success: function(msg) {
			generateOptions(element,msg.list);
		  }
		});
	}
	function sendAjaxDelete(url,data,element,type='POST'){
		var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
		$.ajax({
		  type: 'POST',
		  beforeSend: function(request, settings) {
		  	if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
	            request.setRequestHeader("X-CSRFToken", csrftoken);
	        }
		    request.setRequestHeader('x-api-key', x_api_key);
		  },
		  url: url,
		  data:data,
		  dataType: "json",
		  success: function(msg) {
		  	console.log(element)

		  	element.closest("form").submit();
		  }
		});
	}
	function csrfSafeMethod(method) {
	    // these HTTP methods do not require CSRF protection
	    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
	}
	// using jQuery
	function getCookie(name) {
	    var cookieValue = null;
	    if (document.cookie && document.cookie !== '') {
	        var cookies = document.cookie.split(';');
	        for (var i = 0; i < cookies.length; i++) {
	            var cookie = jQuery.trim(cookies[i]);
	            // Does this cookie string begin with the name we want?
	            if (cookie.substring(0, name.length + 1) === (name + '=')) {
	                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
	                break;
	            }
	        }
	    }
	    return cookieValue;
	}


	function generateOptions(element,data) {
			element.append('<option>{% trans "select"|title %}</option>')
			$.each(data, function(){
				element.append('<option value="'+ this.name +'">'+ this.name +'</option>')			
			});
	}

	function clearOptions(element){
		element.find('option').remove();
	}

	$(document).on('click', '.deleteSpecialist', function() {
    	id 		= $(this).data('id');
    	url 	= '{% url "dashboard:actor-specialists-delete"  %}'
    	data 	= {'specialist_id': id}

    	sendAjaxDelete(url,data,$(this));
	});

	
	
</script>


  
{% endblock %}